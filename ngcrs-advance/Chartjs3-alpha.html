<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chart.js example</title>
    <link rel="stylesheet" href="style2023.css" />
  </head>
  <body>
    <div class="batteryLifeChart">
      <canvas id="batteryLifeChart" class="canvas"></canvas>
      <div class="batteryLifeChartLabel">
        <div class="rank">상위 50%</div>
        <div class="score">
          <div class="number">68</div>
          <div class="text">점</div>
        </div>
        <div class="status">주의</div>
      </div>
    </div>
    <div class="batteryChargeChart">
      <div class="leftSelector">

      </div>
      <div class="rightSelector" >

      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const batteryLifeCanvas = document.getElementById("batteryLifeChart");

      const CHART_SIZE = 335;
      const CUTOUT_RATIO = 0.78;
      const DATA = 0.68;
      const STATUS = "NORMAL";
      const IMAGE_RADIUS = 23;

      const GRADIENT_A = ["#418bf9", "#3378df"];
      const GRADIENT_B = ["#00c3b9", "#00aba2"];
      const GRADIENT_C = ["#ff464b", "#da291c"];

      const BATTERY_LIFE_A = "./images/batteryLifeA.svg";
      const BATTERY_LIFE_B = "./images/batteryLifeB.svg";
      const BATTERY_LIFE_C = "./images/batteryLifeC.svg";

      const batteryLifeGradient = batteryLifeCanvas
        .getContext("2d")
        .createLinearGradient(0, 0, 0, 335);
      
      const batteryImg = new Image();

      if (STATUS === "GOOD") {
        batteryImg.src = BATTERY_LIFE_A;
        batteryLifeGradient.addColorStop(0, GRADIENT_A[0]);
        batteryLifeGradient.addColorStop(1, GRADIENT_A[1]);
      } else if (STATUS === "NORMAL") {
        batteryImg.src = BATTERY_LIFE_B;
        batteryLifeGradient.addColorStop(0, GRADIENT_B[0]);
        batteryLifeGradient.addColorStop(1, GRADIENT_B[1]);
      } else {
        batteryImg.src = BATTERY_LIFE_C;
        batteryLifeGradient.addColorStop(0, GRADIENT_C[0]);
        batteryLifeGradient.addColorStop(1, GRADIENT_C[1]);
      }

      new Chart(batteryLifeCanvas, {
        type: "doughnut",
        data: {
          labels: ["배터리 수명점수"],
          datasets: [
            {
              data: [DATA, 1 - DATA],
              backgroundColor: [batteryLifeGradient, "#ffffff00"],
              borderWidth: 0,
              borderRadius: 30,
            },
          ],
        },
        options: {
          animation: {
            animateScale: false,
            animateRotate: true,
            onProgress: function (context) {
              const curChart = context.chart;
              const curCtx = context.chart.ctx;
              const endPointRad =
                curChart.getDatasetMeta(0).data[0].outerRadius / 2 +
                curChart.getDatasetMeta(0).data[0].innerRadius / 2; // length from center to endPoint
              const px =
                curChart.getDatasetMeta(0).data[0].x -
                endPointRad *
                  Math.sin(
                    curChart.getDatasetMeta(0).data[0].circumference - Math.PI
                  ) -
                IMAGE_RADIUS;
              const py =
                curChart.getDatasetMeta(0).data[0].y +
                endPointRad *
                  Math.cos(
                    curChart.getDatasetMeta(0).data[0].circumference - Math.PI
                  ) -
                IMAGE_RADIUS;
              curCtx.drawImage(batteryImg, px, py);
            },
          },
          cutout: `${CUTOUT_RATIO * 100}%`,
          layout: {
            padding: 15,
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              enabled: false,
            },
          },
          spacing: 0,
        },
      });
    </script>
    <script>
      
    </script>
  </body>
</html>
